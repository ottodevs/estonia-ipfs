<html>
<head>

<link rel="stylesheet" href="topcoat-desktop-dark.css" type="text/css" media="screen">

<script type="text/javascript" src="jquery-2.0.3.min.js"></script>

  <script src="gitversion.js"></script>
  <script src="hwcrypto-legacy.js"></script>
  <script src="hwcrypto.js"></script>
  <script src="hex2base.js"></script>
  
  <style>
    * { margin: 10px; }
    textarea { font-face: courier; }
  </style>
  
<script type="text/javascript">

function writeipfs() {

	var writeipfstarget = "http://localhost:8081/writeipfs";

	var data = $("#writeipfsdata").val();

	$.post(writeipfstarget, {"data":data})
	.done(function() {
		alert("success!");
	})
	.fail(function(err) {
		alert("error: " + JSON.stringify(err));
	});
}

function signipfs() {

	var data = convertToHex($("#writeipfsdata").val());

	var lang = "en";
	var hashtype = "SHA-256";
	var backend = "auto";

    window.hwcrypto.debug().then(function(response) {
      alert("Debug: " + response);
    });

    if (!window.hwcrypto.use(backend)) {
      alert("Selecting backend failed.");
    }

    window.hwcrypto.getCertificate({lang:lang}).then(function(response) {
      var cert = response;
      alert("Using certificate:\n" + hexToPem(response.hex));
      window.hwcrypto.sign(cert, {type: hashtype, hex: data}, {lang: lang}).then(function(response) {
        alert("Generated signature:\n" + response.hex.match(/.{1,64}/g).join("\n"));
      }, function(err) {
        alert("sign() failed: " + err);
      });
    }, function(err) {
      alert("getCertificate() failed: " + err);
    });
}

</script>

</head>
<body>
<p><button class="topcoat-button--large" onclick="writeipfs();">Write to IPFS:</button></p>
<p><button class="topcoat-button--large" onclick="signipfs();">Sign with E-Residency card</button></p>
<textarea class="topcoat-textarea" id="writeipfsdata" type="text" cols="80" rows="8">
{name:'Markus Sabadello',location:'Vienna'}
</textarea>
</p>
<hr>
</body>
</html>
